# 1コマ漫画生成アプリ (Manga-Generator-API-1koma)

Google Gemini API (`gemini-3-pro-image-preview`) を利用した、高品質1コマイラスト生成デスクトップアプリケーションです。
キャラクター参照画像を使用して、一貫性のあるキャラクターでイラストを生成できます。

詳しい使い方や開発背景については、[Qiita記事](https://qiita.com/KLaboratory/items/77b81226d1db8089c7fc)をご覧ください。

## 特徴

- **最新AIモデル**: `gemini-3-pro-image-preview` (Gemini 3 Pro) を使用
- **キャラクター最大5人**: 複数キャラクターの同時登場に対応
- **キャラクター参照画像**: 画像を添付して顔や外見の一貫性を保持
- **服装ビルダー**: ドロップダウンで服装を選ぶだけで英語プロンプトを自動生成
- **多彩な出力モード**:
  - イラスト生成（通常の1コマイラスト）
  - 全身三面図（フロント・サイド・バック）
  - 顔三面図（正面・斜め・横顔）
  - 背景生成（キャラクターなしの背景のみ）
  - 装飾テキスト
- **参考画像清書モード**: ブラウザ版Geminiで生成した下書きを、API版で高品質化
- **カラーモード**: フルカラー / モノクロ / セピア / 二色刷り
- **出力スタイル**: 漫画風、アニメ風、劇画風、水彩風、アメコミ風など多数
- **セリフ・ナレーション**: 吹き出しとナレーションテキストの配置
- **YAML入出力**: プロンプトの保存・読み込み・再編集が可能
- **安全・清潔**: 仮想環境 (`.venv`) で動作するためシステムを汚しません

## 画面レイアウト

```
┌────────────────┬──────────────────────────┬────────────────┐
│  左列          │     中央列               │  右列          │
│ ・出力モード   │  ・キャラクター1〜5      │ ・YAMLプレビュー│
│ ・APIモード    │    - 名前                │                │
│ ・API Key      │    - 説明                │ ・画像プレビュー│
│ ・タイトル     │    - 画像添付            │                │
│ ・作者名       │    - 服装設定            │ [読込][履歴]   │
│ ・カラーモード │                          │ [コピー][保存] │
│ ・出力スタイル │                          │ [画像保存]     │
│ ・アスペクト比 │                          │                │
│ ・シーン説明   │                          │                │
│ ・セリフ入力   │                          │                │
│ ・ナレーション │                          │                │
│                │  [Generate] [クリア]     │                │
└────────────────┴──────────────────────────┴────────────────┘
```

## 必要要件

- **OS**: macOS / Windows / Linux
- **Python**: バージョン 3.10 以上
- **Google AI API Key**: [Google AI Studio](https://aistudio.google.com/apikey) で取得

## インストールと起動

### macOS / Linux

```bash
./run_app.command
```

### Windows

`run_app_windows.bat` をダブルクリック

初回起動時は自動的にセットアップ（仮想環境作成・依存ライブラリインストール）が行われます。

## 使い方

### 基本的な流れ

1. **API Key入力**: Google AI API Keyを入力
2. **出力モード選択**: イラスト生成 / 三面図 / 背景生成 から選択
3. **キャラクター設定**:
   - 名前を入力
   - 「画像あり」の場合は参照画像のパスを指定
   - 「画像なし」の場合は説明文でキャラクターを指定
   - 服装ビルダーで服装を設定
4. **シーン説明**: 生成したいシーンを詳しく記述
5. **セリフ・ナレーション**: 必要に応じて追加
6. **Generate**: ボタンをクリックして生成開始
7. **画像保存**: 生成された画像を保存

### 出力モード別の使い方

#### イラスト生成（通常モード）
1コマのイラストを生成します。シーン説明、キャラクター、セリフを組み合わせて使用。

#### 全身三面図
キャラクターの全身を正面・側面・背面の3方向から描いた設定画を生成。
- シーン説明は空欄でもOK（デフォルト：無表情・気をつけの姿勢）
- キャラクター参照画像を設定すると、その外見を再現

#### 顔三面図
キャラクターの顔を正面・斜め・横顔の3方向から描いた設定画を生成。
- シーン説明は空欄でもOK（デフォルト：無表情）
- 全身画像を参照しても顔のみを生成

#### 背景生成
キャラクターなしの背景のみを生成。シーン説明に背景の詳細を記述。

### 参考画像清書モード

ブラウザ版Geminiで生成した下書き画像を、API版で高品質化するワークフロー：

1. **APIモード**で「参考画像清書」を選択
2. **参考画像**にブラウザ版で生成した下書き画像のパスを指定
3. **キャラクター参照画像**を設定（顔の一貫性を保持）
4. **Generate**で清書版を生成

## 服装ビルダー機能

キャラクターの服装を詳細に指定し、AIが理解しやすい英語プロンプトを自動生成します。

### 選択項目

| 項目 | 選択肢例 |
|------|----------|
| カテゴリ | おまかせ / モデル用 / スーツ / 水着 / カジュアル / 制服 / ドレス / スポーツ / 和服 / 作業着 |
| 形状 | カテゴリに応じた選択肢（例：水着→三角ビキニ、ホルターネック等） |
| 色 | 黒 / 白 / 紺 / 赤 / ピンク / 青 / 水色 / 緑 / 黄 / オレンジ / 紫 / ベージュ / グレー / ゴールド / シルバー |
| 柄 | 無地 / ストライプ / チェック / 花柄 / ドット / ボーダー / トロピカル / レース / 迷彩 / アニマル柄 |
| スタイル | 大人っぽい / 可愛い / セクシー / クール / 清楚 / スポーティ / ゴージャス / ワイルド / 知的 / ダンディ |

### 使い方

1. カテゴリを選択すると、形状の選択肢が自動で切り替わります
2. 色・柄・スタイルを選択
3. 「おまかせ」を選ぶとその項目はAIに任せます

**例**: 水着 + 三角ビキニ + 黒 + 無地 + セクシー
→ `black, solid color, plain, triangle bikini, sexy, alluring`

## 出力スタイル一覧

| スタイル名 | 説明 |
|------------|------|
| おまかせ | AIにスタイルを任せる |
| シンプルな漫画風 | クリーンな線、セルシェーディング |
| 精緻な劇画風 | リアルなシェーディング、ドラマチック |
| アニメ風 | 鮮やかな色彩、表現豊か |
| 水彩イラスト風 | 柔らかい色合い |
| アメコミ風 | 大胆な色使い、ダイナミック |
| 少女漫画風 | キラキラ、柔らかい雰囲気 |
| 少年漫画風 | ダイナミックアクション、太い線 |
| 実写風 | フォトリアリスティック |
| ドット絵風 | 16bit、レトロゲーム風 |
| SDキャラ風 | 二頭身、ちびキャラ |

## YAML機能

### 保存
生成したプロンプトをYAMLファイルとして保存。後から読み込んで再編集可能。

### 読み込み
過去に保存したYAMLファイルを読み込み、UIに設定を復元。

### 履歴
最近使用した5件のファイルにすぐアクセス可能。

## ディレクトリ構成

```
.
├── app/
│   ├── main.py              # アプリケーション本体
│   ├── constants.py         # 定数定義
│   ├── requirements.txt     # 依存ライブラリ
│   └── logic/
│       ├── api_client.py    # Gemini API通信
│       ├── yaml_generator.py # YAML生成ロジック
│       ├── file_manager.py  # ファイル操作
│       └── character.py     # キャラクター処理
├── template.yaml            # テンプレートファイル
├── run_app.command          # macOS/Linux起動スクリプト
├── run_app_windows.bat      # Windows起動スクリプト
├── .gitignore
└── README.md
```

## 依存ライブラリ

- customtkinter - モダンなUIフレームワーク
- PyYAML - YAML処理
- pyperclip - クリップボード操作
- Pillow - 画像処理
- google-genai - Google Gemini API

## トラブルシューティング

### API呼び出しでエラーが出る
- API Keyが正しく入力されているか確認
- インターネット接続を確認
- 安全性フィルターに引っかかった場合は、プロンプトや参照画像を変更

### 画像が生成されない
- シーン説明が具体的か確認
- キャラクター参照画像のパスが正しいか確認

### 顔三面図で全身が生成される
- 最新版にアップデート（プロンプトが強化されています）
- それでも発生する場合は、シーン説明に「face only, no body」を追加

## ライセンス

MIT License

## 関連プロジェクト

- [NanoBanana Pro](https://github.com/tokumeishatyo/NanoBanana) - シンプルな画像生成アプリ
- [Manga-Generator](https://github.com/tokumeishatyo/Manga-Generator) - 4コマ漫画プロンプト作成ツール
