# 1コマ漫画生成アプリ (Manga-Generator-API-1koma)

Google Gemini API (`gemini-3-pro-image-preview`) を利用した、高品質1コマイラスト生成デスクトップアプリケーションです。
段階的な生成ワークフローで、キャラクターデザインからシーン合成まで一貫した制作が可能です。

詳しい使い方や開発背景については、[Qiita記事](https://qiita.com/KLaboratory/items/77b81226d1db8089c7fc)をご覧ください。

## 特徴

- **最新AIモデル**: `gemini-3-pro-image-preview` (Gemini 3 Pro) を使用
- **2つの出力モード**:
  - **YAML出力**: ブラウザ版Geminiにコピペして使用
  - **API画像出力**: アプリ内で直接画像生成（清書モード対応）
- **清書モード**: ブラウザで作成した画像をAPIで高画質化（詳細設定不要）
- **段階的生成ワークフロー**: キャラデザイン → ポーズ → エフェクト → シーン合成
- **キャラクター参照画像**: 画像を添付して顔や外見の一貫性を保持
- **服装ビルダー**: ドロップダウンで服装を選ぶだけで英語プロンプトを自動生成
- **多彩な出力モード**:
  - キャラデザイン（全身三面図/顔三面図）
  - ポーズ付きキャラ
  - エフェクト追加
  - 背景生成
  - 装飾テキスト（技名/決め台詞/キャラ名プレート/メッセージウィンドウ）
- **シーンビルダー**: バトル/ストーリー/ボスレイドのシーン合成
- **装飾テキスト配置**: 最大11箇所に配置可能（キャラ相対位置対応）
- **カラーモード**: フルカラー / モノクロ / セピア / 二色刷り
- **出力スタイル**: 漫画風、アニメ風、劇画風、水彩風、アメコミ風など多数
- **YAML入出力**: プロンプトの保存・読み込み・再編集が可能
- **タイトル機能**: ファイル名自動生成、画像へのタイトル合成（オプション）
- **進捗表示**: API生成中の経過時間表示

## 生成ワークフロー

```
1. キャラデザイン（三面図）
   ↓ 参照画像として使用
2. ポーズ付きキャラ
   ↓ ポーズ付き画像として使用
3. エフェクト追加（オプション）
   ↓ エフェクト付き画像として使用
4. シーンビルダーで合成
   - バトルシーン（2キャラ対戦）
   - ストーリーシーン（会話/日常）
   - ボスレイド（巨大ボス vs パーティ）
   + 装飾テキスト配置

## 清書モード（API高画質化）

ブラウザ版Geminiで作成した画像を、APIで高画質化する専用モードです。

```
1. API出力モードを選択
2. 「参考画像清書」を選択
3. 参考画像（ブラウザで生成した画像）を選択
4. タイトル入力（ファイル名用）
5. 解像度選択（1K/2K/4K）
6. 生成ボタン → 高画質化実行
```

**特徴:**
- 詳細設定・YAML不要（参考画像のみでOK）
- 構図・キャラ・色彩を100%保持
- 解像度・線の鮮明さのみ向上
- 保存ファイル名に「_API」サフィックス自動付与

## 画面レイアウト

```
┌─────────────────────────────────────────────────────────────────┐
│  左列（設定）                   │  右列（プレビュー）            │
├─────────────────────────────────┼────────────────────────────────┤
│ ・出力タイプ選択               │  ・YAMLプレビュー              │
│   - キャラデザイン             │    [コピー][保存][読込]        │
│   - ポーズ付きキャラ           │                                │
│   - エフェクト追加             ├────────────────────────────────┤
│   - 背景のみ生成               │  ・画像プレビュー              │
│   - 装飾テキスト               │    (生成中: 経過時間表示)      │
│ ・詳細設定ボタン               │    [画像保存]                  │
│                                │                                │
│ ・スタイル設定                 │                                │
│   - カラーモード               │                                │
│   - 出力スタイル               │                                │
│   - アスペクト比               │                                │
│                                │                                │
│ ・基本情報                     │                                │
│   - タイトル（必須）           │                                │
│   - □画像にタイトルを入れる   │                                │
│   - 作者名                     │                                │
│                                │                                │
│ ・API設定                      │                                │
│   - 出力モード(YAML/API)       │                                │
│   - API Key [×]               │                                │
│   - APIモード(通常/清書)       │                                │
│   - 参考画像                   │                                │
│   - 解像度(1K/2K/4K)           │                                │
│                                │                                │
│ [YAML生成/画像生成] [リセット] │                                │
│ [シーンビルダーを開く]         │                                │
└─────────────────────────────────┴────────────────────────────────┘
```

## 出力タイプ詳細

### キャラデザイン（三面図）
- **全身三面図**: 正面・側面・背面の設定画
- **顔三面図**: 正面・斜め・横顔の設定画
- キャラクタースタイル選択（標準アニメ/ちびキャラ/リアル調など）
- 服装ビルダーで詳細な服装指定

### ポーズ付きキャラ
- カメラアングル: 正面/斜め/俯瞰/煽り
- ポーズ: 立ち/座り/ジャンプ/攻撃など
- 表情: 笑顔/怒り/悲しみ/驚きなど
- 背景透過対応

### エフェクト追加
- エフェクトタイプ: オーラ/炎/電撃/氷/光/闘気
- 強度: 弱/中/強
- 色設定

### 背景のみ生成
- プリセット: 学校/公園/街中/海辺/ファンタジーなど
- カスタム説明対応

### 装飾テキスト
4タイプから選択:
| タイプ | 説明 | 設定項目 |
|--------|------|----------|
| 技名テロップ | 必殺技名表示 | フォント/サイズ/グラデ色/縁取り/発光 |
| 決め台詞 | キャラの派手なセリフ | 表現タイプ/配色/回転/変形 |
| キャラ名プレート | 名前表示 | デザイン/回転 |
| メッセージウィンドウ | ゲーム風セリフ枠 | モード（フル/顔のみ/セリフのみ） |

### シーンビルダー
3つの合成タイプ:
| タイプ | 用途 | 主な設定 |
|--------|------|----------|
| バトルシーン | 2キャラ対戦 | 衝突タイプ/優勢側/境界エフェクト/画面揺れ |
| ストーリーシーン | 会話/日常 | 配置パターン/距離感/ダイアログ |
| ボスレイド | 巨大ボス戦 | ボススケール/パーティ配置/集中砲火 |

**装飾テキスト配置** (最大11箇所):
- 絶対位置: 上部左/中央/右、中央左/中央/右、下部左/中央/右
- キャラ相対位置: 左キャラ付近（自動）、右キャラ付近（自動）

## 必要要件

- **OS**: macOS / Windows / Linux
- **Python**: バージョン 3.10 以上
- **Google AI API Key**: [Google AI Studio](https://aistudio.google.com/apikey) で取得

## インストールと起動

### macOS / Linux

```bash
./run_app.command
```

### Windows

`run_app_windows.bat` をダブルクリック

初回起動時は自動的にセットアップ（仮想環境作成・依存ライブラリインストール）が行われます。

### macOS アプリ化（Automator）

Dockに置けるアプリとして起動したい場合、Automatorで.appを作成できます。

#### 作成手順

1. **Automator.app を開く**（Launchpadまたは `/Applications/Automator.app`）

2. **「新規書類」→「アプリケーション」を選択**

3. **左側のライブラリから「シェルスクリプトを実行」をダブルクリック**

4. **以下のスクリプトを入力:**
   ```bash
   cd "/path/to/Manga-Generator-API-1koma"  # ← 実際のパスに書き換え

   # venvがなければ作成
   if [ ! -d ".venv" ]; then
       python3 -m venv .venv
       source .venv/bin/activate
       pip install -r app/requirements.txt --quiet
   else
       source .venv/bin/activate
   fi

   python3 app/main.py
   ```
   ※ `/path/to/` の部分を実際のフォルダパスに変更してください

5. **Command + S で保存**
   - 名前: `MangaGenerator`（任意）
   - 場所: アプリケーション（または任意の場所）
   - フォーマット: アプリケーション

6. **作成した.appをDockにドラッグ**で登録完了

#### メリット

- ターミナルが開かない
- Dockからワンクリック起動
- Pythonコードを更新しても再作成不要（即反映）

#### アイコンの変更（任意）

1. 好きな画像を用意（.png, .jpg など）
2. プレビュー.appで開き、Command + C でコピー
3. 作成した.appを右クリック →「情報を見る」
4. 左上のアイコンをクリックして選択状態に
5. Command + V でペースト

### macOS スタンドアロンアプリ（PyInstaller）

Python環境に依存しない完全なスタンドアロンアプリを作成できます。

```bash
./build_app.sh
```

ビルド完了後、`dist/1コマ漫画生成.app` が生成されます。

**注意**: ビルドはmacOS環境で行う必要があります（Docker/Linux環境ではmacOS用アプリは生成できません）。

## ディレクトリ構成

```
.
├── app/
│   ├── main.py                          # メインアプリケーション
│   ├── constants.py                     # 定数定義
│   ├── requirements.txt                 # 依存ライブラリ
│   ├── logic/
│   │   ├── api_client.py                # Gemini API通信（清書モード対応）
│   │   ├── yaml_generator.py            # YAML生成ロジック
│   │   ├── file_manager.py              # ファイル操作・タイトル合成
│   │   └── character.py                 # キャラクター処理
│   └── ui/
│       ├── base_settings_window.py      # 設定ウィンドウ基底クラス
│       ├── character_sheet_window.py    # キャラデザイン設定
│       ├── pose_window.py               # ポーズ設定
│       ├── effect_window.py             # エフェクト設定
│       ├── background_window.py         # 背景設定
│       ├── decorative_text_window.py    # 装飾テキスト設定
│       ├── text_overlay_placement_window.py  # テキスト配置設定
│       └── scene_builder_window.py      # シーンビルダー
├── template.yaml                        # テンプレートファイル
├── run_app.command                      # macOS/Linux起動スクリプト
├── run_app_windows.bat                  # Windows起動スクリプト
├── build_app.sh                         # PyInstallerビルドスクリプト
├── manga_generator.spec                 # PyInstaller設定ファイル
└── README.md
```

## YAMLテンプレート

各出力タイプは対応するYAMLテンプレートに準拠:

| テンプレート | 用途 |
|--------------|------|
| character_basic.yaml | キャラデザイン（三面図） |
| character_pose.yaml | ポーズ付きキャラ |
| character_effect.yaml | エフェクト追加 |
| background_template.yaml | 背景生成 |
| ui_text_overlay.yaml | 装飾テキスト |
| scene_composite.yaml | バトルシーン合成 |
| story_scene_composite.yaml | ストーリーシーン合成 |
| boss_raid_composition.yaml | ボスレイド合成 |

## 依存ライブラリ

- customtkinter - モダンなUIフレームワーク
- PyYAML - YAML処理
- Pillow - 画像処理・タイトル合成
- google-genai - Google Gemini API

## ブランチ構成

| ブランチ | 説明 |
|----------|------|
| main | 段階的生成パターン（推奨） |
| oldpattern | 旧1画面完結パターン（バックアップ） |

## ライセンス

MIT License

## 関連プロジェクト

- [NanoBanana Pro](https://github.com/tokumeishatyo/NanoBanana) - シンプルな画像生成アプリ
- [Manga-Generator](https://github.com/tokumeishatyo/Manga-Generator) - 4コマ漫画プロンプト作成ツール
