# AI創作工房 機能仕様書

**バージョン:** 1.0
**最終更新:** 2025-12-17
**作成者:** 開発チーム

---

## 目次

1. [はじめに](#1-はじめに)
2. [システムアーキテクチャ](#2-システムアーキテクチャ)
3. [機能詳細](#3-機能詳細)
4. [非機能要件](#4-非機能要件)
5. [制限事項・免責](#5-制限事項免責)

---

## 1. はじめに

### 1.1 プロジェクト概要

「AI創作工房」は、Google Gemini API（gemini-3-pro-image-preview）を活用した高品質イラスト生成デスクトップアプリケーションです。キャラクターデザインからシーン合成まで、創作活動に必要な画像生成を一貫したワークフローで提供します。

### 1.2 ターゲットユーザー

- イラストレーター・漫画家（下書き・アイデア出し用途）
- TRPGプレイヤー（キャラクターシート作成）
- 同人誌・Web小説作家（表紙・挿絵作成）
- 教育・ビジネス用途（インフォグラフィック作成）

### 1.3 使用技術

| 項目 | 技術 |
|------|------|
| 言語 | Python 3.10+ |
| GUI | CustomTkinter |
| 画像生成API | Google Gemini API (gemini-3-pro-image-preview) |
| 画像処理 | Pillow |
| データ形式 | YAML |

### 1.4 前提条件

本アプリを使用するには以下が必要です：

| 項目 | 説明 |
|------|------|
| Google AI API Key | [Google AI Studio](https://aistudio.google.com/apikey)で取得 |
| インターネット接続 | API通信に必須 |

**コストに関する注意:**
- Gemini APIは従量課金制です
- 無料枠を超えると料金が発生します
- 詳細は[Google AI料金ページ](https://ai.google.dev/pricing)を参照してください
- 本アプリはAPI使用量をトラッキングする機能を提供しています

---

## 2. システムアーキテクチャ

### 2.1 全体構成

```
【図を挿入: システムアーキテクチャ図】
- UI層、ロジック層、API層、データ層の4層構造を示す図
- 各層間のデータフローを矢印で表現
```

### 2.2 レイヤー構成

| レイヤー | 役割 | 主要ファイル |
|----------|------|--------------|
| UI層 | ユーザー入力の受付・結果表示 | `main.py`, `ui/*.py` |
| ロジック層 | YAML生成・データ処理 | `logic/yaml_generator.py`, `logic/reference_collector.py` |
| API層 | Gemini APIとの通信 | `logic/api_client.py` |
| データ層 | ファイル管理・設定保存 | `logic/file_manager.py`, `logic/usage_tracker.py` |

### 2.3 処理フロー

```
【図を挿入: 基本処理フロー図】
1. ユーザーが設定ウィンドウでパラメータ入力
2. ロジック層でYAMLプロンプト生成
3. API層でGemini APIに送信
4. 生成画像を受信・表示・保存
```

### 2.4 画面構成

```
【図を挿入: メイン画面のスクリーンショット】
- 左列: 出力タイプ選択、基本設定
- 中央列: YAMLプレビュー、参照画像プレビュー
- 右列: 生成画像プレビュー、操作ボタン
```

### 2.5 画像資産のフロー

```
【図を挿入: 画像リレー図（データフロー）】
Step1(顔) ──→ Step2(素体) ──→ Step3(衣装) ──→ Step4(ポーズ)
                                    │              │
                                    ↓              ↓
                               シーン合成 ←── 角度変更
                                    │
                                    ↓
                              スタイル変換
                            (ちびキャラ/ドット)
```

---

## 3. 機能詳細

### 3.1 出力モード

本アプリは4つの出力モードを提供します。

| モード | 説明 | 用途 |
|--------|------|------|
| YAML出力 | YAMLをクリップボードにコピー | ブラウザ版Geminiで使用 |
| 通常モード | アプリ内で直接画像生成 | 標準的な画像生成 |
| 清書モード | 参考画像+YAMLで高品質再描画 | ブラウザ版で成功した画像の高解像度化 |
| シンプルモード | テキストプロンプトのみで生成 | 手軽な画像生成 |

#### 3.1.1 共通設定

全モードで以下の設定が可能です：

**アスペクト比:**
| オプション | 比率 | 用途 |
|------------|------|------|
| 1:1（正方形） | 1:1 | SNSアイコン、汎用 |
| 16:9 | 16:9 | 横長、プレゼン、サムネイル |
| 9:16 | 9:16 | 縦長、スマホ壁紙、4コマ漫画 |
| 4:3 | 4:3 | 標準的な横長 |
| 3:4 | 3:4 | 標準的な縦長 |
| 3:1 | 3:1 | 三面図用 |

**解像度:**
| オプション | 説明 |
|------------|------|
| 2K | 高解像度（推奨） |
| 1K | 標準解像度 |

**カラーモード:**
| オプション | 説明 |
|------------|------|
| フルカラー | 標準的なカラー出力 |
| モノクロ | 白黒 |
| セピア | セピア調 |
| デュオトーン | 2色構成（色指定可能） |

---

### 3.2 ファイル管理

#### 3.2.1 画像の保存

| 項目 | 仕様 |
|------|------|
| 保存タイミング | 生成完了後に保存ダイアログ表示 |
| 自動命名 | 「タイトル_API.png」形式を提案 |
| 形式 | PNG（透過対応） |

#### 3.2.2 YAMLの保存・読込

| 機能 | 説明 |
|------|------|
| YAML保存 | 生成したプロンプトをファイル保存 |
| YAML読込 | 保存済みYAMLを読み込んで再利用 |
| 履歴 | 最近使用したファイルを表示 |

---

### 3.3 キャラクター三面図生成

#### 3.3.1 概要

キャラクターの一貫性を保つため、段階的に三面図を生成するワークフローです。

```
【図を挿入: キャラクター生成ワークフロー】
Step1(顔) → Step2(素体) → Step3(衣装) → Step4(ポーズ) → Step5(角度変更)
各ステップの出力画像サンプルを並べた図
```

#### 3.3.2 Step1: 顔三面図

**目的:** キャラクターの顔デザインを確定

| パラメータ | 説明 | 入力形式 |
|------------|------|----------|
| キャラクター名 | 識別用の名前 | テキスト |
| 外見説明 | 髪型、目の色、特徴など | テキスト（複数行） |
| 描画スタイル | 標準アニメ/リアル調/少女漫画風など | プルダウン |
| 参照画像 | 既存キャラクター画像（任意） | 画像ファイル |

**出力仕様:**
- 形式: 正面・横・背面の三面図（1枚の画像）
- アスペクト比: 3:1推奨
- 用途: Step2の入力として使用

#### 3.3.3 Step2: 素体三面図

**目的:** 体型を確定（顔はStep1を継承）

| パラメータ | 説明 | 入力形式 |
|------------|------|----------|
| 顔三面図パス | Step1の出力画像 | 画像ファイル（必須） |
| 体型プリセット | 標準体型/グラマー/スレンダーなど | プルダウン |
| バストサイズ | おまかせ/控えめ/普通など | プルダウン |
| 素体タイプ | 素体（白レオタード）/水着 | プルダウン |

**出力仕様:**
- 形式: 正面・横・背面の三面図
- 制約: 顔三面図の顔をそのまま使用（変更禁止）

#### 3.3.4 Step3: 衣装着用三面図

**目的:** 素体に衣装を着せる

**入力モード:**

| モード | 説明 |
|--------|------|
| プリセットから選ぶ | 服装ビルダーで英語プロンプト自動生成 |
| 参考画像から着せる | 別画像の衣装をキャラに着せる |

**プリセットモードのパラメータ:**

| パラメータ | 説明 |
|------------|------|
| カテゴリ | カジュアル/フォーマル/学生服/ファンタジーなど |
| 色 | おまかせ/赤系/青系など |
| 柄 | おまかせ/無地/ストライプなど |
| スタイル | おまかせ/キュート/クールなど |

**参考画像モードのパラメータ:**

| パラメータ | 説明 |
|------------|------|
| 参考画像 | 着せたい衣装の画像 |
| フィットモード | 素体優先/衣装優先/ハイブリッド |
| 頭部装飾 | 帽子・ヘルメット等を含めるか |

```
【図を挿入: 衣装フィットモード比較図】
素体優先・衣装優先・ハイブリッドの違いを示す比較画像
```

---

### 3.4 ポーズ生成

#### 3.4.1 概要

衣装三面図にポーズを適用し、動きのあるキャラクター画像を生成します。

#### 3.4.2 入力パラメータ

| パラメータ | 説明 | 入力形式 |
|------------|------|----------|
| キャラクター画像 | Step3の出力画像 | 画像ファイル（必須） |
| ポーズプリセット | 波動拳/スペシウム光線/ライダーキックなど | プルダウン |
| カスタムポーズ | 自由記述 | テキスト |
| 表情 | 無表情/笑顔/怒り/泣きなど | プルダウン |
| 視線方向 | 前を見る/カメラ目線/上を見るなど | プルダウン |
| 風エフェクト | なし/微風/強風など | プルダウン |
| 背景透過 | 合成用に透過PNGで出力 | チェックボックス |

#### 3.4.3 ポーズキャプチャ機能

参考画像からポーズのみを取り込む機能です。

**処理:**
1. ユーザーがポーズ参考画像を指定
2. 参考画像のポーズ（体の位置、手足の向き）のみを抽出
3. キャラクターの外見はそのまま維持してポーズを適用

```
【図を挿入: ポーズキャプチャの例】
参考画像（写真やイラスト）→ キャラクターに適用された結果
```

#### 3.4.4 ポーズプリセット一覧

| プリセット | 説明 |
|------------|------|
| 波動拳（かめはめ波） | 両手を合わせてエネルギー弾 |
| スペシウム光線 | 腕を十字に組んで光線発射 |
| ライダーキック | 空中で飛び蹴り |
| 指先ビーム | 人差し指から光線 |
| 坐禅（瞑想） | 結跏趺坐で瞑想 |

---

### 3.5 角度・ズーム変更

#### 3.5.1 概要

ポーズ三面図から任意の角度・ズームで1枚の画像を抽出します。

#### 3.5.2 角度オプション

| オプション | 説明 |
|------------|------|
| 正面 | そのまま |
| ←左向き / →右向き | 横顔 |
| ↖左斜め前 / ↗右斜め前 | 斜め45度 |
| 背面 | 後ろ姿 |
| ↑上から見下ろす | 俯瞰（ハイアングル） |
| ↓下から見上げる | 煽り（ローアングル） |

#### 3.5.3 ズームオプション

| オプション | 説明 |
|------------|------|
| 全身 | 頭からつま先まで |
| 上半身 | 腰から上 |
| バストアップ | 胸から上 |
| 顔アップ | 顔のみ（詳細） |

---

### 3.6 背景生成

#### 3.6.1 概要

シーンの背景画像を生成します。

#### 3.6.2 入力パラメータ

| パラメータ | 説明 | 入力形式 |
|------------|------|----------|
| 背景説明 | 場所、時間帯、天候、雰囲気 | テキスト（複数行） |
| プリセット | 学校・公園・街中・ファンタジーなど | ボタン選択 |
| 参考画像 | 背景の参考にする画像 | 画像ファイル（任意） |
| 変換指示 | 参考画像への変更指示 | テキスト |

#### 3.6.3 プリセット一覧

- 学校（教室昼/教室夜/廊下/屋上）
- 屋外（公園/街中/海辺）
- 室内（自室/オフィス）
- ファンタジー（森/城/ダンジョン）
- SF（宇宙/サイバー都市）

---

### 3.7 シーン合成

#### 3.7.1 概要

複数のキャラクターと背景を組み合わせて1枚のシーン画像を生成します。

```
【図を挿入: シーン合成の例】
バトルシーン・ストーリーシーン・ボスレイドの3種類のサンプル
```

#### 3.7.2 合成タイプ

| タイプ | 説明 | 最大キャラ数 |
|--------|------|--------------|
| バトルシーン | 2キャラの対戦構図 | 2人 |
| ストーリーシーン | 日常・会話シーン | 3人 |
| ボスレイド | 巨大ボス vs パーティ | ボス1体 + 4人 |

#### 3.7.3 バトルシーンのパラメータ

| カテゴリ | パラメータ |
|----------|------------|
| 背景 | ファイル指定 or 情景説明で生成 |
| 左キャラ | 画像、名前、特徴、スケール |
| 右キャラ | 画像、名前、特徴、スケール |
| 衝突演出 | 中央衝突/ビーム衝突など |
| 優勢設定 | 互角/左優勢/右優勢 |
| 境界効果 | 火花と稲妻/オーラ衝突など |

#### 3.7.4 ストーリーシーンのパラメータ

| カテゴリ | パラメータ |
|----------|------------|
| 背景 | ファイル指定 or 情景説明で生成 |
| キャラクター | 画像、表情、特徴（最大3人） |
| レイアウト | 並んで歩く/向かい合うなど |
| 距離感 | 親しい/普通/離れているなど |
| セリフ | 各キャラクターのセリフ |
| ナレーション | シーンのナレーション |

---

### 3.8 スタイル変換

#### 3.8.1 概要

既存のキャラクター画像を別のスタイルに変換します。

#### 3.8.2 変換タイプ

| タイプ | 説明 |
|--------|------|
| ちびキャラ化 | 2〜3頭身のデフォルメキャラに変換 |
| ドットキャラ化 | ピクセルアート/ゲームスプライト風に変換 |

#### 3.8.3 ちびキャラ化のパラメータ

| パラメータ | 説明 |
|------------|------|
| スタイル | スタンダード(2頭身)/ミニマム(1.5頭身)など |
| 衣装保持 | 元の衣装を維持するか |
| ポーズ保持 | 元のポーズを維持するか |

#### 3.8.4 ドットキャラ化のパラメータ

| パラメータ | 説明 |
|------------|------|
| スタイル | 8bit風/16bit風/モダンピクセルなど |
| スプライトサイズ | 32x32/64x64/128x128 |
| 色の保持 | 元の色味を維持するか |

```
【図を挿入: スタイル変換の例】
元画像 → ちびキャラ化結果 → ドットキャラ化結果
```

---

### 3.9 インフォグラフィック生成

#### 3.9.1 概要

キャラクターを中心に据えた図解・情報整理画像を生成します。

```
【図を挿入: インフォグラフィックの例】
グラレコ風、ノート風、マインドマップ風のサンプル
```

#### 3.9.2 スタイル

| スタイル | 説明 |
|----------|------|
| グラレコ風 | カラフルな手描き風図解 |
| ノート風 | 手書きノートのような整理された図解 |
| ポンチ絵 | シンプルな線画スケッチ風 |
| マインドマップ風 | 中心から放射状に広がる構造 |
| ホワイトボード風 | ホワイトボードに描いたような図解 |

#### 3.9.3 入力パラメータ

| パラメータ | 説明 | 必須 |
|------------|------|------|
| タイトル | メインタイトル | ○ |
| 副題 | サブタイトル | |
| メインキャラ画像 | 中央に配置する画像 | ○ |
| おまけ画像 | ちびキャラなど | |
| セクション | 情報項目（最大8つ） | ○ |
| 出力言語 | 日本語/英語/中国語/韓国語 | |

#### 3.9.4 セクション設定

各セクションには以下を設定：
- タイトル（例：「仕事と活動」）
- 説明（複数行テキスト）
- 位置（1〜8 or おまかせ）

```
位置レイアウト:
  [1] [2] [3]
  [4] 画像 [5]
  [6] [7] [8]
```

---

### 3.10 装飾テキスト生成

#### 3.10.1 概要

ゲームUI風の装飾テキスト画像を生成します。

#### 3.10.2 テキストタイプ

| タイプ | 説明 | 用途 |
|--------|------|------|
| 技名テロップ | 必殺技名表示 | バトルシーンの技名演出 |
| 決め台詞 | キャラの派手なセリフ | インパクトのあるセリフ表示 |
| キャラ名プレート | 名前表示 | キャラクター紹介 |
| メッセージウィンドウ | ゲーム風セリフ枠 | アドベンチャーゲーム風演出 |

#### 3.10.3 技名テロップのパラメータ

| パラメータ | オプション |
|------------|------------|
| フォント | 極太明朝/極太ゴシック/筆書きなど |
| サイズ | 特大/大/中/小 |
| グラデーション | 白→青/赤→黄/虹色など |
| 縁取り | 金/銀/黒/なし |
| 発光効果 | 青い稲妻/炎/オーラなど |

#### 3.10.4 メッセージウィンドウのモード

| モード | 説明 |
|--------|------|
| フルスペック | 名前+顔アイコン+セリフ |
| 顔アイコンのみ | 顔アイコン単体 |
| セリフのみ | テキストウィンドウのみ |

```
【図を挿入: 装飾テキストの例】
技名テロップ、決め台詞、メッセージウィンドウのサンプル
```

---

### 3.11 4コマ漫画生成

#### 3.11.1 概要

4コマ形式の漫画を1枚の画像として生成します。

#### 3.11.2 入力パラメータ

| パラメータ | 説明 |
|------------|------|
| キャラクター | 名前、説明、参照画像（最大2人） |
| 各コマの内容 | 起承転結の4コマ分のプロンプト |
| セリフ | 各コマのセリフ（キャラ、内容、位置） |
| ナレーション | 各コマのナレーション（任意） |

#### 3.11.3 出力形式

- レイアウト: 縦1列（上から下へ4コマ）
- アスペクト比: 9:16または2:5推奨

---

### 3.12 画像加工機能

#### 3.12.1 概要

生成済み画像の再加工を行います。

#### 3.12.2 加工モード

| モード | 説明 |
|--------|------|
| 全体改善 | 画像全体の品質向上・修正 |
| 部分修正 | 特定部分のみ変更、他は維持 |

#### 3.12.3 使用方法

1. 生成済み画像をプレビューに表示
2. 「画像を加工」ボタンをクリック
3. 加工モードを選択
4. 指示を入力（例：「目を開けて」「背景をぼかす」）
5. 実行

---

## 4. 非機能要件

### 4.1 パフォーマンス

| 項目 | 要件 |
|------|------|
| 画像生成時間 | 10〜60秒（解像度・複雑さによる） |
| UIレスポンス | 生成中もUI操作可能（非同期処理） |
| 経過時間表示 | 生成中は秒数をリアルタイム表示 |

### 4.2 APIコスト管理

| 機能 | 説明 |
|------|------|
| 使用量トラッキング | 今日/今月の使用回数を表示 |
| 詳細統計 | モード別・解像度別の統計 |
| 確認ダイアログ | API呼び出し前に確認 |

### 4.3 エラーハンドリング

| エラー種別 | 対応 |
|------------|------|
| APIエラー | エラーメッセージ表示、再試行促進 |
| Safety Filter | 「生成できませんでした」と表示 |
| ネットワークエラー | タイムアウト後にエラー表示 |
| ファイルエラー | 適切なエラーメッセージ |

### 4.4 セキュリティ

| 項目 | 対応 |
|------|------|
| APIキー管理 | 入力欄はマスク表示、メモリ上のみ保持 |
| ファイルアクセス | ユーザー指定パスのみアクセス |

---

## 5. 制限事項・免責

### 5.1 一貫性に関する制限

- AI画像生成の特性上、完全に同一のキャラクターデザインが出力されることを保証するものではありません
- 三面図ワークフローにより一貫性の向上を図っていますが、若干の差異が生じる場合があります
- 左右の整合性（右手/左手の対応）はAIの技術的制限により完全ではありません

### 5.2 コンテンツに関する制限

- Gemini APIのSafety Filterにより、一部のコンテンツは生成が拒否される場合があります
- 生成されたコンテンツの著作権・利用権はユーザーの責任で管理してください
- 参考画像を使用する場合、その画像の著作権に注意してください

### 5.3 動作環境

| 項目 | 要件 |
|------|------|
| OS | Windows 10+, macOS 10.15+, Linux |
| Python | 3.10以上 |
| メモリ | 4GB以上推奨 |
| ネットワーク | インターネット接続必須 |

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| 三面図 | 正面・横・背面の3方向からの図 |
| YAML | 設定・プロンプトの記述形式 |
| プロンプト | AIへの指示文 |
| Safety Filter | 不適切コンテンツを検出するAIの機能 |

### B. ファイル形式

| 形式 | 用途 |
|------|------|
| PNG | 生成画像（透過対応） |
| YAML | プロンプト保存 |
| JSON | 設定・統計データ |

---

**文書終了**
